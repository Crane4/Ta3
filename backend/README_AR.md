# خادم سامر (SAMER Backend)

الخادم الخلفي لاستقبال وعرض البلاغات من تطبيق سامر.

## التثبيت

```bash
cd backend
npm install
```

## تشغيل الخادم

```bash
npm start
```

سيعمل الخادم على الرابط: `http://localhost:3000`

## المميزات

- **تتبع البلاغات في الوقت الفعلي**: استقبال البلاغات عبر WebSocket أو HTTP.
- **لوحة تحكم إدارية**: لوحة تحكم احترافية مبنية بـ Vue.js تحتوي على:
  - خريطة تفاعلية (Leaflet.js)
  - إحصائيات حية
  - تتبع الوحدات النشطة
  - إدارة البلاغات
- **إدارة الأجهزة**: تتبع الأجهزة المتصلة، حالة البطارية، والموقع.
- **نظام مصادقة آمن**: نظام تسجيل دخول (تجريبي: admin/admin123).

## لوحة التحكم

يمكن الوصول للوحة التحكم عبر `http://localhost:3000`.

**بيانات الدخول:**
- اسم المستخدم: `admin`
- كلمة المرور: `admin123`

### أقسام لوحة التحكم
1. **نظرة عامة**: إحصائيات رئيسية وعرض الخريطة.
2. **البلاغات**: قائمة بجميع البلاغات المستلمة مع إمكانية التصفية.
3. **الوحدات النشطة**: قائمة حية بالأجهزة المتصلة (الدوريات) مع حالة البطارية والموقع.

## نقاط الاتصال (API Endpoints)

### POST /api/incidents
استقبال بلاغ جديد من التطبيق.

### POST /api/auth/login
تسجيل دخول المدراء.

### GET /api/devices
الحصول على قائمة الأجهزة النشطة.

## واجهة WebSocket

يوفر الخادم نقطة اتصال WebSocket للاتصال ثنائي الاتجاه في الوقت الفعلي.

**الرابط:** `ws://localhost:3000/ws/incidents`

### تسجيل وتتبع الأجهزة

#### العميل -> الخادم: تسجيل الجهاز (Register)
يتم إرسالها عند الاتصال للتعريف بالجهاز.
```json
{
  "type": "register",
  "payload": {
    "id": "UNIT-1234",
    "type": "mobile",
    "name": "دورية 1234",
    "battery": 95
  }
}
```

#### العميل -> الخادم: نبض القلب (Heartbeat)
يتم إرسالها كل 5 ثوانٍ لتحديث الحالة.
```json
{
  "type": "heartbeat",
  "payload": {
    "id": "UNIT-1234",
    "battery": 94,
    "location": { "latitude": 24.7, "longitude": 46.7 }
  }
}
```

## السجلات (Logs)
يحتفظ تطبيق الهاتف بسجلات محلية لنشاط الشبكة والبلاغات في `src/services/loggerService.js`، ويتم تخزينها عبر AsyncStorage.
